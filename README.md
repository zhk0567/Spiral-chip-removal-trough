# 螺旋排屑槽三维CAD建模工具

## 项目简介

这是一个**螺旋排屑槽三维CAD建模工具**，使用Python直接生成带螺旋槽的圆柱体3D模型，支持Open3D专业可视化。

**核心功能**：参数化设计螺旋排屑槽，生成3D mesh模型和交互式可视化。

## 主要特性

- 🎯 **直接生成法**：不使用复杂的布尔运算，直接生成带螺旋槽的mesh
- 📊 **专业可视化**：使用Open3D进行高性能3D可视化
- 🎛️ **参数化设计**：灵活调整螺旋角、直径、长度等参数
- 🖱️ **交互式调整**：实时调整参数并预览3D模型（使用`--interactive`参数）
- ✏️ **边缘描边**：自动添加关键几何边缘的粗线条描边，使用不同颜色区分不同类型的边缘
- 🔄 **自然交汇**：螺旋槽从z=0开始，自然交汇形成平滑的椭圆形顶部闭合
- 📐 **专业级精度**：适合工业制造和CAD/CAM应用

## 快速开始

### 1. 环境要求
- Python 3.8+
- trimesh（必需）
- open3d（必需，用于3D可视化）
- matplotlib（必需，用于交互式参数调整）

### 2. 安装依赖
```bash
pip install trimesh open3d matplotlib numpy
```

### 3. 运行程序

**标准模式**（Open3D可视化）：
```bash
python spiral_groove_3d_cad.py
```

**交互式参数调整模式**（实时调整参数并预览）：
```bash
python spiral_groove_3d_cad.py --interactive
```

在交互式模式下：
- 拖动滑块调整参数（D1、L1、L2、A1、槽深、槽数）
- 3D模型会实时更新
- 点击"Open3D查看"按钮在Open3D中查看高质量3D模型

## 参数说明

- **D1**：刀具直径 (mm)
- **L1**：导向长度 (mm) - 从z=0到螺旋槽起始位置的长度，螺旋槽在此范围内深度逐渐增加
- **L2**：排屑槽长度 (mm) - 螺旋槽的完整长度，从L1位置开始
- **A1**：螺旋角 (度) - 螺旋槽的螺旋角度
- **blade_height**：槽深 (mm) - 螺旋槽的深度
- **num_flutes**：螺旋槽数量（通常为2或3）

**注意**：螺旋槽从z=0开始延伸，在z=0处所有槽会自然交汇形成一个平滑的椭圆形顶部闭合点。

## 输出文件

- `spiral_groove_front.png`：前视图截图（如果使用Open3D截图功能）

## 可视化说明

### Open3D可视化
- 高性能3D可视化，支持交互式旋转、缩放、平移
- 自动添加关键边缘描边，使用不同颜色区分：
  - 下端面圆周：蓝色
  - 上端面圆周：绿色
  - 螺旋槽边缘：多种颜色区分不同类型的边缘线
- 窗口标题显示所有参数值
- 初始视图设置为XZ正方向视角

### 交互式参数调整
- 使用matplotlib滑块实时调整参数
- 3D模型实时更新
- 支持在Open3D中查看高质量模型

## 技术实现

### 核心算法
- **直接mesh生成**：使用参数化方法直接生成mesh，避免复杂的布尔运算
- **平滑过渡**：使用cos曲线和指数函数实现平滑的边缘过渡
- **自然交汇**：螺旋槽从z=0开始，在z=0处半径逐渐缩小到0，形成自然交汇
- **自动mesh修复**：使用trimesh和Open3D的mesh修复功能，确保模型质量

### 几何特性
- **螺旋槽范围**：从z=0延伸到L1+L2
- **槽深过渡**：在z<L1时，槽深度逐渐减小，在z=0时为0
- **半径收敛**：在z<L1时，半径逐渐缩小到0，形成自然交汇点
- **边缘描边**：自动提取并绘制关键几何边缘，包括：
  - 槽与圆柱外边缘的交界线（峰的位置）
  - 槽的侧面边缘线
  - 槽的"锋"边缘线（过渡区域）
  - 槽的起始端和结束端边缘线

### 性能优化
- 支持高分辨率网格（默认400×160采样点）
- 交互式模式使用较低分辨率以提高响应速度
- 边缘描边使用管道（tube）mesh实现，支持批量处理

## 使用示例

### 基本使用
```python
from spiral_groove_3d_cad import create_spiral_groove_mesh, visualize_open3d

# 创建模型
mesh, params = create_spiral_groove_mesh(
    D1=10.0,           # 直径10mm
    L1=5.0,            # 导向长度5mm
    L2=150.0,          # 排屑槽长度150mm
    A1=40.0,           # 螺旋角40度
    blade_height=1.5,   # 槽深1.5mm
    num_flutes=3       # 3个螺旋槽
)

# 可视化
visualize_open3d(mesh, params=params, interactive=True)
```

## 注意事项

1. **Open3D必需**：程序需要Open3D库进行3D可视化，请确保已正确安装
2. **Windows系统**：在Windows上可能需要安装Visual C++ Redistributable
3. **性能考虑**：高分辨率模型可能需要较长的生成时间，建议在交互式模式下使用较低分辨率
4. **参数范围**：建议参数在合理范围内，避免极端值导致模型异常

## 更新日志

### 最新版本
- ✅ 实现螺旋槽从z=0开始，自然交汇形成椭圆形顶部
- ✅ 添加边缘描边功能，使用不同颜色区分不同类型的边缘
- ✅ 优化可视化性能，支持高分辨率模型
- ✅ 移除STL文件生成，专注于Open3D可视化
- ✅ 改进交互式参数调整界面

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请提交Issue或联系开发者。
